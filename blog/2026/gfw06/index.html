<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> GFW Technical Review 06 – HTTPS and Domain Fronting | Kaiyan Fan </title> <meta name="author" content="Kaiyan Fan"> <meta name="description" content="The Internet's shift toward HTTPS presents a major challenge to GFW"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?v=a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?v=f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?v=62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?v=591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A6%B8&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?v=d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://kaiyanfan.github.io/blog/2026/gfw06/"> <script src="/assets/js/theme.js?v=48c9b5bd7f2e0605e39e579400e22553"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?v=5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Kaiyan</span> Fan </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">Teaching </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">GFW Technical Review 06 – HTTPS and Domain Fronting</h1> <p class="post-meta"> Created on January 27, 2026 </p> <p class="post-tags"> <a href="/blog/2026"> <i class="fa-solid fa-calendar fa-sm"></i> 2026 </a>   ·   <a href="/blog/category/gfw"> <i class="fa-solid fa-tag fa-sm"></i> GFW</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <figure style="text-align:center;"> <img src="/assets/img/posts/gfw06/cover.png" width="70%"> </figure> <p>GFW originated in the late 1990s to early 2000s – the very early days of the Internet. Its original DPI strategies, like keyword and URL matching against plaintext HTTP, have largely lost their effectiveness on the modern Internet. Today, the vast majority of web traffic runs over HTTPS. This is not good news for GFW, but it has found ways to adapt.</p> <hr> <h4 id="tls">TLS</h4> <p>To understand how GFW handles HTTPS traffic, we first need to understand TLS – the cryptographic protocol underlying HTTPS.</p> <p>When a client connects to an HTTPS server, the two parties perform a TLS handshake immediately after the TCP three-way handshake to establish a secure channel. This handshake accomplishes several things: the server proves its identity through a certificate, the parties agree on cryptographic parameters by exchanging supported cipher suites, and they derive shared session keys for encrypting subsequent communication through a key exchange. Once the handshake completes, all application data is encrypted. An eavesdropper sees only opaque ciphertext and can learn nothing about the content being transferred – which pages are visited, what data is submitted, or what responses are returned.</p> <figure style="text-align:center;"> <img src="/assets/img/posts/gfw06/tls.png" width="70%"> <figcaption>TLS 1.2 Handshake</figcaption> </figure> <p>However, TLS was not designed with censorship resistance in mind. The handshake itself, particularly in TLS 1.2 and earlier, exposes metadata that proves invaluable to censors. The most significant piece of exposed information is the Server Name Indication, or SNI.</p> <h4 id="server-name-indication-sni">Server Name Indication (SNI)</h4> <p>SNI is a TLS extension that allows a client to indicate which hostname it is attempting to connect to during the handshake. It was introduced to solve a practical problem: a single IP address often hosts multiple HTTPS websites, and the server needs to know which certificate to present before the encrypted channel is established. Although technically optional in the protocol specification, SNI is practically mandatory due to the prevalence of shared hosting, and is used by virtually all clients.</p> <p>The SNI field is sent in the ClientHello message – the very first message from client to server – and it is sent in plaintext. This creates a fundamental information leak: even though the content of HTTPS communication is encrypted, the destination hostname is visible to any network observer.</p> <figure style="text-align:center;"> <img src="/assets/img/posts/gfw06/pcap.png" width="85%"> <figcaption>Example Client Hello packet. Server domain name is in plaintext</figcaption> </figure> <p>For GFW, SNI is a gift. It provides a reliable, standardized field that reveals exactly which website a user is attempting to visit. GFW can simply inspect the SNI field of every TLS ClientHello and match it against a blocklist of forbidden domains. When a match is found, GFW injects TCP RST packets to terminate the connection, just as it does for other blocked content.</p> <h4 id="encrypted-client-hello-ech">Encrypted Client Hello (ECH)</h4> <p>The plaintext SNI troubles the entire Internet security community. It represents the most substantial privacy leak remaining in the TLS/HTTPS infrastructure. <strong>Encrypted Server Name Indication (ESNI)</strong> was introduced to address this issue, and its successor, <strong>Encrypted Client Hello (ECH)</strong>, has since been standardized as a TLS 1.3 extension.</p> <p>ECH works by splitting the ClientHello into two parts: an outer portion with the standard plaintext ClientHello format, and an inner portion containing encrypted extensions – including the real SNI and other sensitive fields like ALPN. For compatibility reasons, the outer extensions still contain a plaintext SNI, but this is a decoy (often pointing to a generic CDN hostname). Only the encrypted inner SNI reveals the actual destination.</p> <p>Encrypting the inner ClientHello presents a bootstrapping problem: at this point, no TLS connection has been established, so there is no secure channel available. ECH solves this by working in conjunction with DNS – typically DNS-over-HTTPS to prevent DNS-level leakage. Along with the standard IP address, the DNS response includes the server’s ECH configuration, which contains a public key. The client uses this public key to encrypt the inner ClientHello. The server decrypts it and proceeds with the real handshake, while GFW sees nothing useful.</p> <figure style="text-align:center;"> <img src="/assets/img/posts/gfw06/ech.png" width="70%"> <figcaption>TLS 1.3 Handshake with ECH</figcaption> </figure> <p>ECH poses a major challenge for GFW. It eliminates the only field that GFW can reliably use to identify the destination. Fortunately for GFW, ECH deployment remains limited. While most major browsers already support ECH, server-side adoption will take years to become widespread. This allows GFW to block all ECH connections without causing significant collateral damage for the time being.</p> <p>Researchers have observed that GFW inspects the TLS extension identifiers in ClientHello messages and drops packets (rather than injecting TCP RST) when it detects ESNI or ECH. This is followed by residual censorship on that connection for two to three minutes. However, as ECH adoption grows over the coming years, the collateral damage from blanket blocking will become substantial, and GFW may be forced to abandon this approach.</p> <hr> <h4 id="domain-fronting">Domain Fronting</h4> <p>Domain fronting is a circumvention technique designed to evade GFW’s SNI-based censorship. It was widely used between 2014 and 2018 in popular circumvention tools like <em>Lantern</em>, exploiting a non-standard behavior that major cloud providers unintentionally supported.</p> <p>In an HTTPS connection, the destination domain name appears in three places: the DNS request, the TLS ClientHello (SNI), and the HTTP Host header inside the encrypted request. The first two are visible to GFW; the third is encrypted.</p> <p>Ordinarily, the same domain name is used in all three places. The key insight of domain fronting is to use different domain names. In the DNS query and TLS SNI – both visible to the censor – the client specifies a benign domain that happens to share infrastructure with the blocked domain. Inside the encrypted HTTP request, the Host header points to the actual blocked destination.</p> <figure style="text-align:center;"> <img src="/assets/img/posts/gfw06/df.png" width="70%"> <figcaption>Domain Fronting</figcaption> </figure> <h4 id="cdn-infrastructure">CDN Infrastructure</h4> <p>Domain fronting works exceptionally well on the modern Internet, where CDNs are often the first point of entry for web requests. CDN providers such as Google Cloud and Cloudflare act on behalf of origin servers, processing user requests directly. If a request hits a CDN cache, the cached content is returned immediately. Otherwise, the CDN forwards the request to the origin server on the user’s behalf.</p> <figure style="text-align:center;"> <img src="/assets/img/posts/gfw06/cdn.png" width="65%"> <figcaption>User requests are often handled by CDN frontend servers first</figcaption> </figure> <p>CDN frontend servers typically host a wide range of websites, particularly popular ones. Crucially, they use the HTTP Host header to determine which website a request is intended for. This means that if the TLS SNI and HTTP Host header specify different domains, the CDN will happily accept the TLS connection as long as it hosts the domain in the SNI, but then route the traffic according to the Host header.</p> <p>With domain fronting, GFW loses the ability to block by SNI alone. Its only options are to block the CDN server by IP entirely – causing massive collateral damage – or to let the traffic through. In 2018, Russian authorities attempted to block Telegram, which used domain fronting, by banning 1.8 million IP addresses belonging to major cloud providers. This knocked countless legitimate websites offline. Eventually, the Russian authorities were forced to reverse course and lift the bans.</p> <p>A variation of domain fronting is domain hiding, where the TLS ClientHello simply omits the SNI extension entirely. In this case, GFW has no domain name to match against. SNI-less connections constitute a significant portion of Internet traffic, so blocking them indiscriminately would also incur substantial collateral damage.</p> <h4 id="the-decline-of-domain-fronting">The Decline of Domain Fronting</h4> <p>Domain fronting was a short-lived technique. Though powerful, it relied on unintended behavior that was never part of any Internet standard. Starting around 2018, major cloud and CDN providers began disabling domain fronting.</p> <p>Several factors drove this decision. There were terms-of-service concerns, as domain fronting effectively allows traffic to impersonate one service while actually destined for another. There were also security concerns: attackers could use domain fronting to disguise malicious traffic as legitimate connections to trusted services. And of course, there was speculation that government pressure played a role as well.</p> <hr> <h4 id="closing-thoughts">Closing Thoughts</h4> <p>As the Internet has shifted toward encryption and HTTPS, GFW faces significant challenges. Classic DPI methodologies have become increasingly ineffective. For now, the presence of plaintext SNI and the decline of domain fronting mean that GFW can still effectively censor HTTPS traffic. But the long-term trend toward ECH may fundamentally alter this dynamic. The rise of HTTPS has also created new opportunities for circumvention technologies. Rather than relying on “looks like nothing” protocols like Shadowsocks, newer protocols have emerged that disguise themselves as legitimate HTTPS traffic, making fingerprinting even more difficult for GFW. We will explore how this cat-and-mouse game continues to evolve in future posts.</p> <hr> <h4 id="references">References</h4> <ul> <li>Cloudflare. What is a TLS handshake. <a href="https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake/" rel="external nofollow noopener" target="_blank">https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake/</a> </li> <li>Cloudflare. Encrypted Client Hello - the last puzzle piece to privacy. <a href="https://blog.cloudflare.com/announcing-encrypted-client-hello/" rel="external nofollow noopener" target="_blank">https://blog.cloudflare.com/announcing-encrypted-client-hello/</a> </li> <li>GFW Report. Exposing and Circumventing China’s Censorship of ESNI. <a href="https://gfw.report/blog/gfw_esni_blocking/en/" rel="external nofollow noopener" target="_blank">https://gfw.report/blog/gfw_esni_blocking/en/</a> </li> <li>David Fifield, Chang Lan, Rod Hynes, Percy Wegmann, and Vern Paxson. Blocking-resistant communication through domain fronting. In Proceedings on Privacy Enhancing Technologies 2015. <a href="https://petsymposium.org/2015/papers/03_Fifield.pdf" rel="external nofollow noopener" target="_blank">https://petsymposium.org/2015/papers/03_Fifield.pdf</a> </li> <li>Russia Bans 1.8 Million Amazon and Google IPs in Attempt to Block Telegram. <a href="https://www.bleepingcomputer.com/news/government/russia-bans-18-million-amazon-and-google-ips-in-attempt-to-block-telegram/" rel="external nofollow noopener" target="_blank">https://www.bleepingcomputer.com/news/government/russia-bans-18-million-amazon-and-google-ips-in-attempt-to-block-telegram/</a> </li> </ul> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/gfw05/">GFW Technical Review 05 – Shadowsocks</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/gfw04/">GFW Technical Review 04 – The West Chamber Project</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/gfw03/">GFW Technical Review 03 – Deep Packet Inspection</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/gfw02/">GFW Technical Review 02 – VPN</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/gfw01/">GFW Technical Review 01 – Architecture</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2026 Kaiyan Fan. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?v=a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?v=85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?v=2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?v=c15de51d4bb57887caa2c21988d97279"></script> <script defer src="/assets/js/copy_code.js?v=c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?v=d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?v=a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?v=2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?v=f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>